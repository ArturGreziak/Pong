<!DOCTYPE html>
<html lang="pl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <canvas
      id="gameCanvas"
      width="800"
      height="600"
      style="display: block; margin: 100px auto;"
    ></canvas>

    <script>
      let canvas, canvasContext
      let ballX = 20
      let ballY = 20
      let ballSpeedX = 2
      let ballSpeedY = 3

      let paddle1Y = 300
      let paddle2Y = 300
      const paddleHeight = 100
      const paddleDistFromEdge = 10
      const paddleThickness = 10

      window.onload = () => {
        canvas = document.querySelector('#gameCanvas')
        canvasContext = canvas.getContext('2d')

        canvas.addEventListener('mousemove', (event) => {
          let mousePos = calculateMousePosition(event)
          paddle2Y = mousePos.y - paddleHeight / 2
        })

        setInterval(() => {
          moveEveryhing()
          drawEverything()
        }, 1000 / 60)
      }

      const ballReset = () => {
        ballSpeedX = -ballSpeedX
        ballX = canvas.width / 2
        ballY = canvas.height / 2
      }

      const calculateMousePosition = (event) => {
        let gameRect = canvas.getBoundingClientRect()
        let root = document.documentElement

        let mouseX = event.clientX - gameRect.left - root.scrollLeft
        let mouseY = event.clientY - gameRect.top - root.scrollTop

        return { x: mouseX, y: mouseY }
      }

      const moveEveryhing = () => {
        ballX = ballX + ballSpeedX
        ballY = ballY + ballSpeedY
        if (ballY < 0) {
          ballSpeedY = -ballSpeedY
        }
        if (ballY > canvas.height) {
          ballSpeedY = -ballSpeedY
        }
        if (ballX < 0) {
          ballReset()
        }
        if (ballX > canvas.width) {
          ballReset()
        }

        let playerPaddleTop = paddle1Y
        let playerPaddleBottom = paddle1Y + paddleHeight
        let playerPaddleLeft = paddleDistFromEdge
        let playerPaddleRight = paddleDistFromEdge + paddleThickness

        if (
          ballY >= playerPaddleTop &&
          ballY <= playerPaddleBottom &&
          ballX >= playerPaddleLeft &&
          ballX <= playerPaddleRight
        ) {
          ballSpeedX = -ballSpeedX
        }

        let opponentPaddleTop = paddle1Y
        let opponentPaddleBottom = paddle1Y + paddleHeight
        let opponentPaddleLeft = canvas.width - paddleDistFromEdge - paddleThickness
        let opponentPaddleRight = canvas.width - paddleDistFromEdge

        if (
          ballY >= opponentPaddleTop &&
          ballY <= opponentPaddleBottom &&
          ballX >= opponentPaddleLeft &&
          ballX <= opponentPaddleRight
        ) {
          ballSpeedX = -ballSpeedX
        }
        
      }

      const drawEverything = () => {
        // narysuj tło i "odśwież ekran"
        drawRectangle(0, 0, canvas.width, canvas.height, 'black')

        // narysuj piłkę
        drawCircle(ballX, ballY, 10, 'red')

        // narysuj paletkę gracza
        drawRectangle(
          paddleDistFromEdge,
          paddle1Y,
          paddleThickness,
          paddleHeight,
          'white',
        )

        // narysuj paletkę przeciwnika
        drawRectangle(
          canvas.width - paddleThickness - paddleDistFromEdge,
          paddle2Y,
          paddleThickness,
          paddleHeight,
          'white',
        )
      }

      const drawRectangle = (posX, posY, width, height, color) => {
        canvasContext.fillStyle = color
        canvasContext.fillRect(posX, posY, width, height)
      }

      const drawCircle = (centerX, centerY, radius, color) => {
        canvasContext.fillStyle = 'red'
        canvasContext.beginPath()
        canvasContext.arc(ballX, ballY, 10, 0, Math.PI * 2)
        canvasContext.fill()
      }
    </script>
  </body>
</html>
